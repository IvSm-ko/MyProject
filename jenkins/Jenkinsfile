pipeline {
    agent any
    tools {
        jdk 'JDK'
        maven 'mvn'
        git 'Default'
    }
    stages {
        stage('Testing Java') {
            steps {
                sh 'mvn clean'
                sh 'mvn test'
            }
        }
//         stage('build') {
//             steps {
//                 sh 'pip install -r requirements.txt'
//             }
        // }
//         stage ('Testing Python'){
//             steps {
//                 sh 'python unit-test.py'
//             }
//          
        stage ('Testing Python'){
            steps {
                sh 'echo \'--- Creating Python3 Virtual Environment ---\'
                    VIRTUAL_ENV_NAME=\'virtual-environment\'
                    Python3 -m venv $VIRTUAL_ENV_NAME'
            }
            steps{
                sh 'echo \'--- Activating Virtual Environmet ---\'
                    source $VIRTUAL_ENV_NAME/bin/activate'
            }
            steps{
                sh 'echo \'--- Installing requirements ---\'
                    pip install -r ./bwg-cli/requirements.txt'
            }
            steps{
                sh 'cd /var/lib/jenkins/workspace/$JOB_NAME/
                    echo \'--- Starting Tests ---\'
                    pytest ./bwg-cli/test --junitxml=./xmlReport/output.xmlReport'
            }
            steps {
                sh 'echo \'--- Deaktivating Virtual Environment ---\'
                    deactivate'
            }
        }
    }
}
